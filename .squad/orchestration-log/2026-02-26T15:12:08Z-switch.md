# Switch — Agreement Domain Test Infrastructure

**Timestamp:** 2026-02-26T15:12:08Z  
**Agent:** Switch (Java/DDD Architect)  
**Requested by:** Leonardo Moreira  
**Mode:** background  
**Model:** claude-sonnet-4.5

## Task

Create domain test infrastructure for Agreement aggregate (AgreementAssert + AgreementBuilder).

## Context

Spawned as part of multi-agent test infrastructure creation for Agreement module. Domain test builders and assertions enable readable, maintainable tests following TMS patterns.

## Files Authorized to Read

- `/home/leonardo/Projetos/leonardo/tms/src/main/java/br/com/logistics/tms/company/domain/Agreement.java`
- `/home/leonardo/Projetos/leonardo/tms/doc/ai/prompts/test-data-builders.md`
- `/home/leonardo/Projetos/leonardo/tms/doc/ai/TEST_STRUCTURE.md`
- Existing builder/assert patterns (CompanyBuilder, CompanyAssert)

## Files Produced

- `/home/leonardo/Projetos/leonardo/tms/src/test/java/br/com/logistics/tms/company/domain/AgreementAssert.java` (210 lines)
- `/home/leonardo/Projetos/leonardo/tms/src/test/java/br/com/logistics/tms/company/domain/AgreementBuilder.java` (181 lines)
- Decision: `.squad/decisions/inbox/switch-agreement-test-infrastructure.md`

## Outcome

✅ **SUCCESS**

Created comprehensive test infrastructure with:
- **AgreementAssert:** 20+ fluent assertion methods covering all Agreement behaviors (isActive, isValidOn, overlapsWith, isBetween, configuration entries)
- **AgreementBuilder:** Sensible defaults (DELIVERS_WITH, validFrom=now, validTo=null, minimal config) with fluent withers for all fields
- **Dual overloads:** Accept both CompanyId and UUID for from/to relationships
- **Domain-aware:** Dedicated assertions for Agreement-specific logic (isActive, overlapsWith, date ranges)
- **Pattern compliance:** All finals, factory method usage, immutable design

**Compilation:** ✅ SUCCESS (`mvn test-compile` passed)

## Decision Impact

Sets standard for Agreement test data creation. Existing tests can be refactored to use these utilities. Future test writing becomes faster and more consistent.
