@server = http://localhost:8080

### â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
### ğŸ“– COMPANY AGREEMENT STORY
### â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
###
### BUSINESS SCENARIO:
### Three companies enter the TMS ecosystem:
###   â€¢ Shoppe (marketplace) needs logistics providers
###   â€¢ Loggi (logistics provider) serves multiple clients
###   â€¢ Biquelo (seller) ships through logistics providers
###
### AGREEMENTS:
###   1. Shoppe â†’ Loggi: 10% discount (later updated to 15%)
###   2. Biquelo â†’ Loggi: 30% discount + Day+1 SLA requirement
###
### This file demonstrates:
###   âœ“ Agreement creation with conditions
###   âœ“ Querying agreements (all, by company)
###   âœ“ Updating agreement terms (conditions, validity)
###   âœ“ Removing agreements
###   âœ“ Negative cases (duplicates, self-reference, expired)
###
### â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”


### â”â”â” STEP 1: CREATE SHOPPE (MARKETPLACE) â”â”â”
POST {{server}}/companies
Content-Type: application/json
Accept: application/json

{
  "name": "Shoppe",
  "cnpj": "42.123.456/0001-78",
  "types": ["MARKETPLACE"],
  "configuration": {
    "notification": "true",
    "webhook": "https://api.shoppe.com.br/webhooks/tms"
  }
}

> {% client.global.set("shoppeId", response.body.companyId) %}


### â”â”â” STEP 2: CREATE LOGGI (LOGISTICS PROVIDER) â”â”â”
POST {{server}}/companies
Content-Type: application/json
Accept: application/json

{
  "name": "Loggi",
  "cnpj": "13.895.286/0001-96",
  "types": ["LOGISTICS_PROVIDER"],
  "configuration": {
    "notification": "true",
    "webhook": "https://api.loggi.com/webhooks/partners",
    "coverage": "nationwide"
  }
}

> {% client.global.set("loggiId", response.body.companyId) %}


### â”â”â” STEP 3: CREATE BIQUELO (SELLER) â”â”â”
POST {{server}}/companies
Content-Type: application/json
Accept: application/json

{
  "name": "Biquelo ComÃ©rcio EletrÃ´nico",
  "cnpj": "28.765.432/0001-91",
  "types": ["SELLER"],
  "configuration": {
    "notification": "true",
    "webhook": "https://biquelo.com.br/api/logistics/callback",
    "shippingRegions": ["SP", "RJ", "MG"]
  }
}

> {% client.global.set("biqueloId", response.body.companyId) %}


### â”â”â” STEP 4: CREATE AGREEMENT â€” SHOPPE â†’ LOGGI (10% DISCOUNT) â”â”â”
# Business context: Shoppe negotiates bulk discount with Loggi
POST {{server}}/companies/{{shoppeId}}/agreements
Content-Type: application/json
Accept: application/json

{
  "targetCompanyId": "{{loggiId}}",
  "relationshipType": "DELIVERS_WITH",
  "validFrom": "2026-02-24T00:00:00Z",
  "validTo": "2026-12-31T23:59:59Z",
  "conditions": [
    {
      "type": "DISCOUNT_PERCENTAGE",
      "value": "10.0"
    }
  ]
}

> {% client.global.set("shoppeLoggiAgreementId", response.body.agreementId) %}


### â”â”â” STEP 5: CREATE AGREEMENT â€” BIQUELO â†’ LOGGI (30% DISCOUNT + SLA) â”â”â”
# Business context: Biquelo gets premium terms (higher discount + SLA requirement)
POST {{server}}/companies/{{biqueloId}}/agreements
Content-Type: application/json
Accept: application/json

{
  "targetCompanyId": "{{loggiId}}",
  "relationshipType": "USES_PROVIDER",
  "validFrom": "2026-02-24T00:00:00Z",
  "validTo": "2027-02-23T23:59:59Z",
  "conditions": [
    {
      "type": "DISCOUNT_PERCENTAGE",
      "value": "30.0"
    },
    {
      "type": "DELIVERY_SLA_DAYS",
      "value": "1"
    }
  ]
}

> {% client.global.set("biqueloLoggiAgreementId", response.body.agreementId) %}


### â”â”â” STEP 6: QUERY SHOPPE AGREEMENTS â”â”â”
# Should show 1 agreement: Shoppe â†’ Loggi
GET {{server}}/companies/{{shoppeId}}/agreements
Accept: application/json


### â”â”â” STEP 7: QUERY LOGGI AGREEMENTS â”â”â”
# Should show 2 agreements: Loggi receives from both Shoppe and Biquelo
# Note: Loggi is the TARGET in both agreements, not the source
GET {{server}}/companies/{{loggiId}}/agreements
Accept: application/json


### â”â”â” STEP 8: GET SPECIFIC AGREEMENT BY ID â”â”â”
# Retrieve Shoppe â†’ Loggi agreement details
GET {{server}}/companies/{{shoppeId}}/agreements/{{shoppeLoggiAgreementId}}
Accept: application/json


### â”â”â” STEP 9: UPDATE SHOPPE â†’ LOGGI DISCOUNT (10% â†’ 15%) â”â”â”
# Business context: Shoppe renegotiates higher discount after volume increase
PUT {{server}}/companies/{{shoppeId}}/agreements/{{shoppeLoggiAgreementId}}
Content-Type: application/json
Accept: application/json

{
  "conditions": [
    {
      "type": "DISCOUNT_PERCENTAGE",
      "value": "15.0"
    }
  ]
}


### â”â”â” STEP 10: EXTEND BIQUELO â†’ LOGGI VALIDITY â”â”â”
# Business context: Agreement renewal for another year
PUT {{server}}/companies/{{biqueloId}}/agreements/{{biqueloLoggiAgreementId}}
Content-Type: application/json
Accept: application/json

{
  "validTo": "2028-02-23T23:59:59Z"
}


### â”â”â” STEP 11: REMOVE SHOPPE â†’ LOGGI AGREEMENT â”â”â”
# Business context: Shoppe switches to different provider
DELETE {{server}}/companies/{{shoppeId}}/agreements/{{shoppeLoggiAgreementId}}
Accept: application/json


### â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
### NEGATIVE TEST SCENARIOS
### â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”


### â”â”â” NEGATIVE 1: DUPLICATE AGREEMENT (SHOULD FAIL) â”â”â”
# Business rule: Cannot create duplicate agreement with same target/relationship
POST {{server}}/companies/{{biqueloId}}/agreements
Content-Type: application/json
Accept: application/json

{
  "targetCompanyId": "{{loggiId}}",
  "relationshipType": "USES_PROVIDER",
  "validFrom": "2026-02-24T00:00:00Z",
  "validTo": "2027-02-23T23:59:59Z",
  "conditions": [
    {
      "type": "DISCOUNT_PERCENTAGE",
      "value": "25.0"
    }
  ]
}


### â”â”â” NEGATIVE 2: SELF-REFERENCE AGREEMENT (SHOULD FAIL) â”â”â”
# Business rule: Company cannot create agreement with itself
POST {{server}}/companies/{{biqueloId}}/agreements
Content-Type: application/json
Accept: application/json

{
  "targetCompanyId": "{{biqueloId}}",
  "relationshipType": "DELIVERS_WITH",
  "validFrom": "2026-02-24T00:00:00Z",
  "validTo": "2026-12-31T23:59:59Z",
  "conditions": [
    {
      "type": "DISCOUNT_PERCENTAGE",
      "value": "50.0"
    }
  ]
}


### â”â”â” NEGATIVE 3: EXPIRED AGREEMENT (SHOULD FAIL) â”â”â”
# Business rule: Agreement validFrom/validTo must be logical
POST {{server}}/companies/{{shoppeId}}/agreements
Content-Type: application/json
Accept: application/json

{
  "targetCompanyId": "{{loggiId}}",
  "relationshipType": "DELIVERS_WITH",
  "validFrom": "2026-01-01T00:00:00Z",
  "validTo": "2025-12-31T23:59:59Z",
  "conditions": [
    {
      "type": "DISCOUNT_PERCENTAGE",
      "value": "5.0"
    }
  ]
}


### â”â”â” NEGATIVE 4: INVALID CONDITION VALUE (SHOULD FAIL) â”â”â”
# Business rule: Discount percentage must be between 0 and 100
POST {{server}}/companies/{{shoppeId}}/agreements
Content-Type: application/json
Accept: application/json

{
  "targetCompanyId": "{{loggiId}}",
  "relationshipType": "DELIVERS_WITH",
  "validFrom": "2026-02-24T00:00:00Z",
  "validTo": "2026-12-31T23:59:59Z",
  "conditions": [
    {
      "type": "DISCOUNT_PERCENTAGE",
      "value": "150.0"
    }
  ]
}


### â”â”â” NEGATIVE 5: MISSING TARGET COMPANY (SHOULD FAIL) â”â”â”
# Business rule: Target company must exist
POST {{server}}/companies/{{shoppeId}}/agreements
Content-Type: application/json
Accept: application/json

{
  "targetCompanyId": "00000000-0000-0000-0000-000000000000",
  "relationshipType": "DELIVERS_WITH",
  "validFrom": "2026-02-24T00:00:00Z",
  "validTo": "2026-12-31T23:59:59Z",
  "conditions": [
    {
      "type": "DISCOUNT_PERCENTAGE",
      "value": "10.0"
    }
  ]
}
